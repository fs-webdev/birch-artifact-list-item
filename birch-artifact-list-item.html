<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-image/iron-image.html">
<link rel="import" href="../wc-i18n/wc-i18n.html">
<link rel="import" href="../oak-i18n-behavior/oak-i18n-behavior.html">
<link rel="import" href="audio-item/audio-item.html">
<link rel="import" href="../fs-styles/fs-styles.html">
<script src='../Clamp.js/clamp.min.js'></script>

<!--
An element that renders any artifact in the gallery list format

Example:

    <birch-artifact-list-item></birch-artifact-list-item>

@group Seed Elements
@element birch-artifact-list-item
@demo demo/index.html
@hero hero.svg
-->

<dom-module id="birch-artifact-list-item">
  <link rel="import" type="css" href="birch-artifact-list-item.css">
  <template>
    <wc-i18n-src locale='[[lang]]' locale-dir='[[localeDir()]]' domain='birch-artifact-list-item'></wc-i18n-src>
    <style include='fs-styles'></style>
    <div id='container' on-tap='_goToArtifact'>
      <div class='col col-1'>
        <div class='list-preview'>
          <template is='dom-if' if="[[data.thumbUrl]]">
            <a href$='[[_href]]'>
              <iron-image sizing="cover" position="center 15%" class="thumbnail" src="[[data.thumbUrl]]"></iron-image>
            </a>
          </template>
          <template is='dom-if' if='{{_isAudio(data.category)}}'>
              <audio-item audio-url='[[data.url]]'></audio-item>
          </template>
          <template is='dom-if' if='{{_isStory(data.category)}}'>
            <i class='story-icon'></i>
          </template>
        </div>
        <div class="title" title='[[data.title]]'>
          <a class='title-text' href$='[[_href]]' hidden='[[!data.title]]'><strong>[[data.title]]</strong></a>
          <a href$='[[_href]]?focus=title' hidden='[[data.title]]'>
            <i class='add-icon'></i><wc-i18n key='birch-artifact-list-item.add_title'></wc-i18n>
          </a>
        </div>
      </div>
      <div class='col col-2'>
        <div class='date' title='[[data.datesPlaces.0.dateNormalizedText]]'>
          <a href$='[[_href]]?focus=date' class='date-text'>
            <span hidden='[[!data.datesPlaces.0.dateNormalizedText]]'>[[data.datesPlaces.0.dateNormalizedText]]</span>
          </a>
          <a href$='[[_href]]?focus=date' hidden='[[data.datesPlaces.0.dateNormalizedText]]'>
            <i class='add-icon' ></i><wc-i18n key='birch-artifact-list-item.add_date'></wc-i18n>
          </a>
        </div>
        <div class='place' title='[[data.datesPlaces.0.placeNormalizedText]]'>
          <a href$='[[_href]]?focus=place' class='place-text' hidden='[[!data.datesPlaces.0.placeNormalizedText]]'>
            <span><wc-i18n key='birch-artifact-list-item.in'></wc-i18n> [[data.datesPlaces.0.placeNormalizedText]]</span>
          </a>
          <a href$='[[_href]]?focus=place' hidden='[[data.datesPlaces.0.placeNormalizedText]]'>
            <i class='add-icon'></i><wc-i18n key='birch-artifact-list-item.add_place'></wc-i18n>
          </a>
        </div>
      </div>
      <div class='col col-3'>
        <div class='place' title='[[data.datesPlaces.0.placeNormalizedText]]'>
          <a href$='[[_href]]?focus=place' class='place-text' hidden='[[!data.datesPlaces.0.placeNormalizedText]]'>
            <span><wc-i18n key='birch-artifact-list-item.in'></wc-i18n> [[data.datesPlaces.0.placeNormalizedText]]</span>
          </a>
          <a href$='[[_href]]?focus=place' hidden='[[data.datesPlaces.0.placeNormalizedText]]'>
            <i class='add-icon'></i><wc-i18n key='birch-artifact-list-item.add_place'></wc-i18n>
          </a>
        </div>
      </div>
      <div class='col col-4'>
        <div class='comment-note'>
          <a href$='[[_href]]'>
            <i class='comment-icon' hidden='[[!data.commentCount]]' href$='[[_href]]'>[[data.commentCount]]</i>
          </a>
        </div>
        <div class='tag-note'>
          <a href$='[[_href]]'>
            <i class='not-tagged-icon' hidden='[[_hideTagging(data.photoTagCount, readOnly)]]' title='[[_notTaggedText]]'></i>
          </a>
        </div>
      </div>
    </div>
  </template>

  <script>
    Polymer({
      is: 'birch-artifact-list-item',
      behaviors: [
        WCI18nBehavior,
        OakI18nBehavior,
      ],
      properties: {
        data: {
          type: Object,
          value: function() { return {}; },
        },
        _href: {
          type: String,
          computed: '_computeHref(data.id)'
        },
        mobile: {
          type: Boolean,
          value: false
        },
        selectMode: {
          type: Boolean,
          value: false
        },
        readOnly: {
          type: Boolean,
          value: false
        }
      },
      observers: [
        '_displayFourthColumn(mobile, selectMode)'
      ],
      ready: function() {
        this.listen(window,'resize', '_clamp');
        this._clamp();
      },
      _clamp: function() {
        this.debounce('update-ellipsis', function() {
          if (window.innerWidth < 767) {
            $clamp(this.$$('.title'), {clamp: 3});
          } else {
            $clamp(this.$$('.title'), {clamp: 2});
          }
        }.bind(this), 100) 
      },
      _computeHref: function(id) {
        var origin = window.location.origin;
        var path = (origin === 'http://localhost:5000') ? '' : '/photos';
        return origin + path + '/artifacts/' + id;
      },
      _goToArtifact: function() {
        if (this.selectMode) return;
        window.location.href = this._href;
      },
      _hideTagging: function(photoTagCount, readOnly) {
        if (photoTagCount !== 0 || readOnly) return true
        return false;
      },
      _isAudio: function(category) {
        return category && category == "AUDIO";
      },
      _isStory: function(category){
        return category && category == "TEXT";
      },
      _displayFourthColumn: function(mobile, selectMode) {
        if (!mobile && !selectMode) return;
        var commentEl = this.$$('.comment-note');
        var personTagEl = this.$$('.tag-note');
        if (mobile && selectMode && Boolean(commentEl) && Boolean(personTagEl)) {
          commentEl.hidden = true;
          personTagEl.hidden = true;
        } else if ((commentEl.hidden || personTagEl.hidden) && Boolean(commentEl) && Boolean(personTagEl) ) {
          commentEl.hidden = false;
          personTagEl.hidden = false;
        }
      },
      _stopProp: function(e) {
        if (!this.selectMode) e.stopPropagation();
      }
    });
  </script>
</dom-module>
